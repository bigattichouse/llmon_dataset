{"project":"sendmail","module":"srvrsmtp.c","summary":"This module implements the SMTP server component of Sendmail, handling all SMTP protocol commands, authentication, TLS negotiation, and message processing. It parses SMTP commands, validates client requests, processes mail transactions, and interacts with the mail filtering system (milter).","logs":[{"function":"smtp","message_template":"server %s startup","reason":"Logs when the SMTP server starts processing a connection from a client","resolution":"Information log, no resolution required"},{"function":"smtp","message_template":"ERROR: srv_features=tempfail, relay=%.100s, access temporarily disabled","reason":"Indicates that access has been temporarily disabled for a connecting relay due to server features configuration","resolution":"Check access control configurations and server status; verify if the relay has been blocked for security reasons"},{"function":"smtp","message_template":"AUTH error: sasl_server_new failed=%d","reason":"SASL authentication system initialization failed","resolution":"Check SASL configuration, libraries, and dependencies; may require reinstallation of SASL components or fixing configuration issues"},{"function":"smtp","message_template":"smtps: TLS not available, exiting","reason":"SMTPS (SMTP over SSL) connection attempted but TLS is not available","resolution":"Check TLS configuration in sendmail.cf, verify SSL certificates and OpenSSL installation"},{"function":"smtp","message_template":"Milter: initialization failed, rejecting commands","reason":"The mail filter (milter) system failed to initialize properly","resolution":"Check milter configuration, verify milter connectivity, and restart milter services if needed"},{"function":"smtp","message_template":"Milter: initialization failed, temp failing commands","reason":"The mail filter system failed to initialize and commands are temporarily failing","resolution":"Check milter status and configuration, may require restart of milter services"},{"function":"smtp","message_template":"Milter: initialization failed, closing connection","reason":"The mail filter system failed to initialize, causing connection closure","resolution":"Check milter connectivity, logs, and configuration; may require restart of milter services"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, reject=%s","reason":"A mail filter rejected the connection from the specified host and address","resolution":"Check milter rules and policies to understand why this connection was rejected"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, shutdown=%s","reason":"A mail filter requested shutdown of connection from specified host","resolution":"Check milter configuration and rules to understand why this connection triggered a shutdown"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, temp failing commands=%s","reason":"A milter is causing temporary failures for commands from this host","resolution":"Verify milter status and configuration; may be temporary or indicate an issue with milter services"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, rejecting commands","reason":"A milter is configured to reject commands from the specified host","resolution":"Review milter policies and rules to understand why commands from this host are being rejected"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, temp failing commands","reason":"A milter is causing temporary failure for commands from this host","resolution":"Check milter status and connectivity; issue may resolve on its own or require service restart"},{"function":"smtp","message_template":"Milter: connect: host=%s, addr=%s, shutdown","reason":"A milter requested shutdown of the connection from this host","resolution":"Review milter rules and policies to understand why this connection triggered a shutdown request"},{"function":"smtp","message_template":"rejecting commands from %s [%s] due to pre-greeting traffic","reason":"Client sent data before SMTP greeting, which may indicate spam or an attack","resolution":"If legitimate, client needs to be fixed to properly wait for SMTP greeting; may be a sign of spam or attack"},{"function":"smtp","message_template":"delaying=%s, load average=%d >= %d","reason":"SMTP server is delaying processing due to high system load","resolution":"Check system resources and consider tuning server capacity or reducing load if this occurs frequently"},{"function":"smtp","message_template":"Milter: helo=%s, reject=Command rejected","reason":"A milter rejected the HELO\/EHLO command with the specified parameter","resolution":"Review milter rules for HELO\/EHLO rejection to understand why this client's greeting was rejected"},{"function":"smtp","message_template":"Milter: helo=%s, reject=%s","reason":"A milter rejected the HELO\/EHLO command with a custom message","resolution":"Check milter configurations and rules to understand the reason for rejection"},{"function":"smtp","message_template":"Milter: helo=%s, reject=421 4.7.0 %s closing connection","reason":"A milter rejected the HELO\/EHLO command and requested connection closure","resolution":"Review milter policies to understand why this HELO\/EHLO value caused connection termination"},{"function":"smtp","message_template":"%s didn't use HELO protocol","reason":"Client did not send HELO\/EHLO before attempting mail transfer, which violates SMTP protocol","resolution":"If legitimate, client software needs to be fixed to properly implement SMTP protocol"},{"function":"smtp","message_template":"Host %s claimed to be %s","reason":"Client's stated identity in HELO\/EHLO doesn't match its actual hostname","resolution":"May indicate spoofing or misconfiguration; check client configuration if it's a legitimate server"},{"function":"smtp","message_template":"invalid domain name (too long) from %s","reason":"Client used a domain name in HELO\/EHLO that exceeds maximum length","resolution":"Check client configuration; may indicate an attempt to obfuscate identity or cause buffer overflow"},{"function":"smtp","message_template":"invalid domain name (%s) from %.100s","reason":"Client used an invalid domain name format in HELO\/EHLO command","resolution":"If legitimate, client needs configuration correction; may indicate an attack attempt"},{"function":"smtp","message_template":"SMTP MAIL command (%.100s) from %s tempfailed (due to previous checks)","reason":"MAIL FROM command temporarily failed due to previous policy checks","resolution":"Review mail policies and access control settings that might be causing temporary rejection"},{"function":"smtp","message_template":"%s owned process doing -bs","reason":"A process owned by a user is attempting to use SMTP submission mode, which may indicate spoofing","resolution":"Investigate why this user is accessing SMTP in this manner; may indicate attempted mail spoofing"},{"function":"smtp","message_template":"AUTH=server, relay=%s, authid=%.128s, mech=%.16s, bits=%d","reason":"Successful authentication information for SMTP client","resolution":"Information log, no resolution required"},{"function":"smtp","message_template":"AUTH encode64 error [%d for \"%s\"], relay=%.100s","reason":"Error encoding authentication data during SMTP AUTH process","resolution":"Check SASL library configuration and installation; may indicate a compatibility issue"},{"function":"smtp","message_template":"AUTH failure (%s): %s (%d) %s%s%.*s, relay=%.100s","reason":"Failed authentication attempt during SMTP AUTH","resolution":"Monitor for repeated failures which may indicate brute force attempts; check client configuration if legitimate"},{"function":"smtp","message_template":"SMTP AUTH command (%.100s) from %s tempfailed (due to previous checks)","reason":"AUTH command temporarily failed due to previous security checks","resolution":"Review security policies and throttling settings; may be due to too many failed attempts"},{"function":"smtp","message_template":"SMTP RCPT command (%.100s) from %s tempfailed (due to previous checks)","reason":"RCPT TO command temporarily failed due to previous policy checks","resolution":"Check mail policies and recipient validation settings; temporary condition may resolve automatically"},{"function":"smtp","message_template":"%s: Possible SMTP RCPT flood, shutting down connection.","reason":"Detected potential RCPT command flooding attack, connection terminated","resolution":"Investigate client for malicious behavior; legitimate clients shouldn't send excessive RCPT commands"},{"function":"smtp","message_template":"%s: Possible SMTP RCPT flood, throttling.","reason":"Detected potential RCPT command flooding, applying throttling","resolution":"Monitor the client; if legitimate, it may need to send fewer recipients per message"},{"function":"smtp","message_template":"SMTP ETRN command (%.100s) from %s tempfailed (due to previous checks)","reason":"ETRN command temporarily failed due to previous policy checks","resolution":"Review mail queue flushing policies and access controls for the ETRN command"},{"function":"smtp","message_template":"%s: ETRN %s","reason":"Client requested queue flush via ETRN command","resolution":"Information log, no resolution required"},{"function":"smtp","message_template":"lost input channel from %s to %s after %s","reason":"SMTP connection terminated unexpectedly during command processing","resolution":"Check network stability and client behavior; may indicate network issues or client disconnection"},{"function":"smtp","message_template":"421 4.7.0 %s Command too long, possible attack %s","reason":"Received extremely long command that exceeds limits, possible buffer overflow attempt","resolution":"Investigate client for malicious behavior; legitimate clients shouldn't send overly long commands"},{"function":"smtp","message_template":"%s: SMTP violation, input too long: %lu","reason":"Client sent command that exceeds maximum allowed length","resolution":"If legitimate, client needs to be fixed to send properly sized commands; may indicate an attack"},{"function":"smtp","message_template":"%s: probable open proxy: command=%.40s","reason":"Client appears to be an open proxy based on commands sent","resolution":"Block this client if confirmed as open proxy; these are frequently abused for spam"},{"function":"smtp","message_template":"unauthorized PIPELINING, sleeping, relay=%.100s","reason":"Client is using SMTP command pipelining without server support","resolution":"If legitimate, client needs to be fixed to properly check for PIPELINING support before using it"},{"function":"smtp","message_template":"STARTTLS=server, engine=%s, TLS_set_engine=failed","reason":"Failed to set up TLS engine during STARTTLS command","resolution":"Check OpenSSL configuration and installation; may require reinstalling or reconfiguring TLS components"},{"function":"smtp","message_template":"STARTTLS=server, error: SSL_set_ex_data failed=%d, TLSsslidx=%d","reason":"Error setting SSL extra data during TLS negotiation","resolution":"Check OpenSSL configuration and compatibility; may indicate memory issues or version mismatch"},{"function":"smtp","message_template":"STARTTLS=server, error: accept failed=%d, reason=%s, SSL_error=%d, errno=%d, retry=%d, relay=%.100s","reason":"Error accepting TLS connection during STARTTLS negotiation","resolution":"Check SSL certificates, configuration, and client TLS capabilities; may indicate certificate problems"},{"function":"smtp","message_template":"STARTTLS: can't switch to encrypted layer","reason":"Failed to transition SMTP connection to TLS encryption after successful negotiation","resolution":"Check TLS implementation and I\/O layer handling; may indicate compatibility issues with the client"},{"function":"smtp","message_template":"rejecting %s from %s [%s] due to traffic before response","reason":"Client sent additional data before receiving server response, violating protocol","resolution":"If legitimate, client needs to be fixed to properly wait for server responses; may indicate spam software"},{"function":"smtp","message_template":"%s %s: %.80s","reason":"Process title update with current SMTP transaction information","resolution":"Information log, no resolution required"},{"function":"smtp","message_template":"\"%s\" command from %s (%.100s)","reason":"Received unusual or unauthorized command from client","resolution":"Monitor for patterns of abuse; legitimate clients shouldn't send unrecognized commands"},{"function":"smtp","message_template":"%s did not issue MAIL\/EXPN\/VRFY\/ETRN during connection to %s","reason":"Client connected but didn't perform any mail operations before disconnecting","resolution":"May indicate scanning behavior; monitor for patterns of reconnaissance activity"},{"function":"smtp","message_template":"%s: possible SMTP attack: command=%.40s, count=%u","reason":"Detected potential attack based on excessive repetition of a command","resolution":"Consider blocking the client if pattern continues; legitimate clients shouldn't repeatedly send failed commands"},{"function":"smtp","message_template":"proxy mode requested but not possible","reason":"SMTP proxy mode was requested but conditions don't allow it","resolution":"Review configuration and message conditions that prevent proxy mode operation"},{"function":"smtp","message_template":"fcntl(inchfd, F_GETFL) failed: %s","reason":"Failed to get file descriptor flags for input channel","resolution":"Check system file descriptor limits and configuration; may indicate system resource issues"},{"function":"smtp","message_template":"fcntl(outchfd, F_GETFL) failed: %s","reason":"Failed to get file descriptor flags for output channel","resolution":"Check system file descriptor limits and configuration; may indicate system resource issues"},{"function":"smtp","message_template":"set automode for I (%d)\/O (%d) in SMTP server","reason":"Setting automatic I\/O mode for SMTP server channels","resolution":"Information log, no resolution required"},{"function":"smtp_data","message_template":"Milter: cmd=data, reject=550 5.7.1 Command rejected","reason":"Mail filter rejected the DATA command","resolution":"Check milter rules and policies to understand why DATA phase was blocked"},{"function":"smtp_data","message_template":"Milter: cmd=data, discard","reason":"Mail filter requested message discard during DATA command","resolution":"Review milter configuration to understand why messages are being silently discarded"},{"function":"smtp_data","message_template":"Milter: data, reject=554 5.7.1 Command rejected","reason":"Mail filter rejected message data after processing","resolution":"Check milter content filtering rules to understand why message content was rejected"},{"function":"smtp_data","message_template":"Milter: data, discard","reason":"Mail filter requested message discard after processing message data","resolution":"Review milter content filtering rules to understand discard decision"},{"function":"smtp_data","message_template":"Milter accept: message","reason":"Mail filter accepted the message after processing","resolution":"Information log, no resolution required"},{"function":"smtp_data","message_template":"@collect: bfcommit(%s): already on disk, size=%ld","reason":"Error during message collection: file already exists on disk","resolution":"Check queue directory for permissions and space issues; may indicate duplicate message IDs"},{"function":"smtp_data","message_template":"@Cannot reopen %s","reason":"Failed to reopen message data file after committing to disk","resolution":"Check file system permissions and available space; may indicate I\/O issues"},{"function":"srvfeatures","message_template":"srv_features: unknown feature %s","reason":"Unknown feature specified in server features configuration","resolution":"Check and correct server features configuration; may indicate typo or outdated configuration"},{"function":"srvfeatures","message_template":"srv_features: unknown variant %s","reason":"Unknown variant specified in server features configuration","resolution":"Check and correct server features configuration; may indicate typo or outdated configuration"},{"function":"help","message_template":"%s too old (require version %d)","reason":"Help file version is older than required by the server","resolution":"Update help file to the current version; usually fixed by upgrading sendmail"},{"function":"get_sasl_user","message_template":"AUTH error: listmech=%d, num=%d","reason":"Error listing available SASL authentication mechanisms","resolution":"Check SASL configuration and library installation; may indicate SASL initialization problems"},{"function":"get_sasl_user","message_template":"AUTH: available mech=%s, allowed mech=%s","reason":"Information about available and allowed SASL authentication mechanisms","resolution":"Information log, no resolution required"},{"function":"get_sasl_user","message_template":"AUTH warning: no mechanisms","reason":"No SASL authentication mechanisms are available","resolution":"Check SASL configuration to ensure mechanisms are properly defined and enabled"}]}