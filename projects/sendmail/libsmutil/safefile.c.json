{"project":"sendmail","module":"..\/working\/sendmail\/libsmutil\/safefile.c","summary":"The safefile.c module provides functions to safely access files and directories by checking permissions, ownership, and state changes. It implements security measures to prevent unauthorized access, symbolic link attacks, and similar security vulnerabilities when reading or writing files.","logs":[{"function":"safefile","message_template":"safefile(%s, uid=%d, gid=%d, flags=%lx, mode=%o):\n","reason":"Debug log showing parameters passed to the safefile function when detailed debugging is enabled","resolution":"Informational debug message, no resolution required"},{"function":"safefile","message_template":"\tpathname too long\n","reason":"Logged when a filename is too long to be safely processed","resolution":"Use shorter path names or increase the buffer size if possible"},{"function":"safefile","message_template":"\t[final dir %s uid %d mode %lo] %s\n","reason":"Debug log showing directory status when checking if it's safe to create a file","resolution":"Informational debug message, but might indicate permission issues with directory access"},{"function":"safefile","message_template":"\t[slink mode %lo]\tE_SM_NOSLINK\n","reason":"Logs when a symbolic link is encountered but not allowed by security flags","resolution":"Review security policy if symbolic links need to be allowed, or ensure only regular files are used"},{"function":"safefile","message_template":"\t[non-reg mode %lo]\tE_SM_REGONLY\n","reason":"Logs when a non-regular file is encountered but only regular files are allowed","resolution":"Ensure only regular files are being accessed, not devices, pipes, or other special files"},{"function":"safefile","message_template":"\t[write bits %lo]\tE_SM_GWFILE\n","reason":"Logs when a file has group write permissions but this is not allowed","resolution":"Remove group write permissions from the file with chmod g-w filename"},{"function":"safefile","message_template":"\t[write bits %lo]\tE_SM_WWFILE\n","reason":"Logs when a file has world write permissions but this is not allowed","resolution":"Remove world write permissions from the file with chmod o-w filename"},{"function":"safefile","message_template":"\t[read bits %lo]\tE_SM_GRFILE\n","reason":"Logs when a file has group read permissions but this is not allowed","resolution":"Remove group read permissions from the file with chmod g-r filename"},{"function":"safefile","message_template":"\t[read bits %lo]\tE_SM_WRFILE\n","reason":"Logs when a file has world read permissions but this is not allowed","resolution":"Remove world read permissions from the file with chmod o-r filename"},{"function":"safefile","message_template":"\t[exec bits %lo]\tE_SM_ISEXEC\n","reason":"Logs when a file has execution permissions but this is not allowed","resolution":"Remove execution permissions from the file with chmod -x filename"},{"function":"safefile","message_template":"\t[link count %d]\tE_SM_NOHLINK\n","reason":"Logs when a file has multiple hard links but this is not allowed","resolution":"Use files that don't have multiple hard links or adjust security policy"},{"function":"safefile","message_template":"\t[uid %d, nlink %d, stat %lo, mode %lo] ","reason":"Debug log showing detailed file status information","resolution":"Informational debug message, no resolution required"},{"function":"safefile","message_template":"\tOK\n","reason":"Debug log indicating that safefile check passed","resolution":"Informational debug message, no resolution required"},{"function":"safefile","message_template":"\tEACCES\n","reason":"Debug log indicating access denied during safefile check","resolution":"Check file permissions and ownership, ensure the user has appropriate access"},{"function":"safedirpath","message_template":"safedirpath(%s, uid=%ld, gid=%ld, flags=%lx, level=%d, offset=%d):\n","reason":"Debug log showing parameters passed to the safedirpath function","resolution":"Informational debug message, no resolution required"},{"function":"safedirpath","message_template":"\t[dir %s]\n","reason":"Debug log showing directory being checked in safedirpath","resolution":"Informational debug message, no resolution required"},{"function":"safedirpath","message_template":"\t[dir %s] mode %lo FATAL\n","reason":"Logs when a directory has unsafe permissions that are considered fatal","resolution":"Fix directory permissions to make them secure, removing world or group write access as needed"},{"function":"safedirpath","message_template":"\t[dir %s] mode %lo WARNING\n","reason":"Logs when a directory has potentially unsafe permissions but not considered fatal","resolution":"Consider fixing directory permissions, though operation can continue"},{"function":"safedirpath","message_template":"051 WARNING: %s writable directory %s","reason":"Warning message when a world or group writable directory is detected","resolution":"Change directory permissions to remove world\/group write access for better security"},{"function":"safedirpath","message_template":"\t[dir %s] %s\n","reason":"Debug log showing final status of directory safety check","resolution":"Informational debug message, but may indicate permission issues if not OK"},{"function":"safeopen","message_template":"safeopen: fn=%s, omode=%x, cmode=%x, sff=%lx\n","reason":"Debug log showing parameters passed to the safeopen function","resolution":"Informational debug message, no resolution required"},{"function":"safeopen","message_template":"554 5.3.0 cannot open: file %s changed after open","reason":"Error message when a file changes after being opened, which could indicate a race condition or security issue","resolution":"Check if another process is modifying the file simultaneously, or if there's a potential time-of-check-time-of-use vulnerability"},{"function":"safeopen","message_template":"554 5.3.0 cannot open: file %s could not be truncated","reason":"Error message when a file cannot be truncated after opening","resolution":"Check file permissions and disk space, ensure the user has write access to the file"},{"function":"safefopen","message_template":"554 5.3.5 safefopen: unknown omode %o","reason":"Error message when an invalid file open mode is specified","resolution":"Fix the code to use valid open mode flags (O_RDONLY, O_WRONLY, O_RDWR, etc.)"},{"function":"safefopen","message_template":"safefopen: safeopen failed: %s\n","reason":"Debug log indicating that safeopen failed during safefopen","resolution":"Check the specific error message returned for more details on why opening the file failed"},{"function":"safefopen","message_template":"safefopen: fdopen(%s, %d) failed: omode=%x, sff=%lx, err=%s\n","reason":"Debug log indicating that fdopen failed after the file was successfully opened","resolution":"Check system resources and file descriptor limits, the system may be running out of resources"},{"function":"filechanged","message_template":"File changed after opening:\n nlink\t= %ld\/%ld\n dev\t= %ld\/%ld\n ino\t= %llu\/%llu\n gen\t= %ld\/%ld\n uid\t= %ld\/%ld\n gid\t= %ld\/%ld\n","reason":"Debug log showing detailed information about how a file changed after opening","resolution":"Check if another process is modifying the file simultaneously, or if there's a potential race condition or security issue"}]}